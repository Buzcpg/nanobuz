services:
  nanoclaw:
    image: ghcr.io/buzcpg/nanoclaw-host:latest
    container_name: nanoclaw
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - ASSISTANT_NAME=${ASSISTANT_NAME:-Andy}
      - CONTAINER_IMAGE=ghcr.io/buzcpg/nanoclaw-agent:latest
      # HOST_WORKSPACE: actual host path for Docker-in-Docker mounts
      - HOST_WORKSPACE=${HOST_WORKSPACE:-/home/buzzers123/nanoclaw}
    volumes:
      # Docker socket for spawning agent containers
      - /var/run/docker.sock:/var/run/docker.sock
      # Environment file (needed by container-runner to pass auth to agents)
      - ./.env:/app/.env:ro
      # Persistent data
      - ./store:/app/store
      - ./data:/app/data
      - ./groups:/app/groups
      - ./logs:/app/logs
    working_dir: /app
    # Run as root to access docker.sock (node user inside can't)
    user: root
    healthcheck:
      test: ["CMD", "node", "-e", "process.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
